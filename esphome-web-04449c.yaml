esphome:
  name: esphome-web-04449c
  friendly_name: "ESPHome Ecran RdC"
  min_version: 2024.11.0

logger:
  level: INFO

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

web_server:
  port: 80

ota:
  - platform: esphome

api:

debug:

# -------------------------------------------------------------------
# FONTS
# -------------------------------------------------------------------
font: 
  - id: roboto_principal
    file:
      type: gfonts
      family: Roboto
    size: 20
    bpp: 4
    glyphs: "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzéèêëàâäùûüôöîïçÉÈÊËÀÂÄÙÛÜÔÖÎÏÇ°%+-/():,.?' "
    #glyphs: "U+0020-00FF"
    extras:
      - file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
        glyphs: !include ecran_guition/fonts/glyphs.yaml

  - id: roboto_icon_thermostat_preset
    file:
      type: gfonts
      family: Roboto
    size: 32
    bpp: 4
    glyphs: "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzéèêëàâäùûüôöîïçÉÈÊËÀÂÄÙÛÜÔÖÎÏÇ°%+-/():,. "
    #glyphs: "U+0020-00FF"
    extras:
      - file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
        glyphs: !include ecran_guition/fonts/glyphs.yaml

  - id: roboto_xl
    file:
      type: gfonts
      family: Roboto
    size: 32
    bpp: 4

  - id: roboto_xxl
    file:
      type: gfonts
      family: Roboto
    size: 100
    bpp: 4

  - id: icon_chauffage
    file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
    size: 46
    bpp: 4
    glyphs: !include ecran_guition/fonts/glyphs.yaml
    
  - id: icon_button_home
    file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
    size: 34
    bpp: 4
    glyphs: !include ecran_guition/fonts/glyphs.yaml

  - id: heure_screen_saver
    file:
      type: gfonts
      family: Roboto
    size: 28
    bpp: 4
    
  - id: meteo_actuelle_screen_saver
    file:
      type: gfonts
      family: Roboto
    size: 36
    bpp: 4

  - id: meteo_min_max_screen_saver
    file:
      type: gfonts
      family: Roboto
    size: 18 #MODIF
    bpp: 4

  - id: icons_page_meteo
    file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
    size: 100
    bpp: 4
    glyphs: !include ecran_guition/fonts/glyphs.yaml

  - id: icons_page_screen_saver
    file: https://github.com/Pictogrammers/pictogrammers.github.io/raw/refs/heads/main/@mdi/font/7.4.47/fonts/materialdesignicons-webfont.ttf
    size: 80
    bpp: 4
    glyphs: !include ecran_guition/fonts/glyphs.yaml


# -------------------------------------------------------------------
# SUBSTITUTIONS
# -------------------------------------------------------------------
substitutions:
  home_page: home
  page_anim_time: 400ms
  code: !secret alarmo_code
  # Material Design Icons
  mdi_power: "\U000F0425"
  mdi_chevron_up: "\U000F0143"
  mdi_chevron_down: "\U000F0140"
  mdi_plus: "\U000F0415"
  mdi_minus: "\U000F0374"
  mdi_thermometer: "\U000F050F"
  mdi_sofa: "\U000F04B9"
  mdi_away: "\U000F0B53"
  mdi_home: "\U000F02DC"
  mdi_none: "\U000F09DE"
  mdi_fire: "\U000F0238"
  mdi_security: "\U000F0483"
  mdi_keyboard: "\U000F030C"
  mdi_backspace: "\U000F006E"
  mdi_checkbold: "\U000F0E1E"
  mdi_robot: "\U000F06A9"
  mdi_defrost: "\U000F0D61"
  mdi_ev_plug_type2: "\U000F151E"
  icon_floor_0: "\U000F0DD2"
  icon_floor_1: "\U000F0D80"
  icon_floor_Air_Cond: "\U000F001B"


  # Colors common
  color_grey: "0xa5a5a5"
  color_dark_grey: "0x282828"
  color_darker_grey: "0x212121"
  color_light_grey: "0x444444"
  color_accent: "0x18bcf2"
  color_warning: "0xd2691e"
  color_success: "0x7fff00"
  # Mode colors
  color_auto: "0x2fd1c5"
  color_cool: "0x00bfff"
  color_heat: "0xff1493"
  color_dry: "0xff8c00"
  color_fan: "0x87ceeb"
  # Temperature colors
  color_temp_current: "0x35ffe6"
  color_temp_set: "0x51a0e4"
  color_temp_ticks: "0x585858"


# -------------------------------------------------------------------
# PACKAGES
# -------------------------------------------------------------------
packages:
  device: !include ecran_guition/JC3248W535.yaml
  colors: !include ecran_guition/fonts/COLOR_CSS


# -------------------------------------------------------------------
# SWITCHES
# -------------------------------------------------------------------
switch:
  # Switch système redémarrage
  - platform: restart
    name: Restart

  # Switch chauffage rdc
  - platform: homeassistant
    name: switch_chauffage_rdc_sensor
    id: switch_chauffage_rdc_sensor
    entity_id: switch.chauffage_relais_x2_right
    disabled_by_default: false
    on_state:
      then:
        - if:
            condition:
              lambda: 'return x;'
            then:
              - lvgl.label.update:
                  id: rdc_button_label
                  text_color: ${color_success}
            else:
              - lvgl.label.update:
                  id: rdc_button_label
                  text_color: ${color_grey}
  
  # Switch Chauffage étage
  - platform: homeassistant
    name: switch_chauffage_etage_sensor
    id: switch_chauffage_etage_sensor
    entity_id: switch.chauffage_relais_x2_left
    disabled_by_default: false
    on_state:
      then:
        - if:
            condition:
              lambda: 'return x;'
            then:
              - lvgl.label.update:
                  id: etage_button_label
                  text_color: ${color_success}
            else:
              - lvgl.label.update:
                  id: etage_button_label
                  text_color: ${color_grey}

  # Switch Lumière de l'atelier
  - platform: homeassistant
    name: lumiere_atelier
    id: lumiere_atelier
    entity_id: switch.automatisme_atelier_lumiere_switch
    disabled_by_default: false      
    on_state:
      then:
        lvgl.widget.update:
          id: button_lumiere_atelier_switch
          state:
            checked: !lambda return x;


# -------------------------------------------------------------------
# SENSORS
# -------------------------------------------------------------------
binary_sensor:
  - platform: status
    name: Status
  # Etat de la caméra
  - platform: homeassistant
    name: camera_state
    id: camera_state
    entity_id: binary_sensor.logbook_tapo
    disabled_by_default: false      
    on_state:
      then:
        lvgl.widget.update:
          id: camera_state__switch
          state:
            checked: !lambda return x;
  # Infos Corsa
  - platform: homeassistant
    name: corsa_pre_conditionnement
    id: corsa_pre_conditionnement
    entity_id: binary_sensor.vxkuhzkxzm4079619_air_conditionne_2
    disabled_by_default: false
    trigger_on_initial_state: true
    on_state:
      then:
        lvgl.widget.update:
          id: btn_corsa
          state:
            checked: !lambda return x;
  - platform: homeassistant
    name: corsa_branchee
    id: corsa_branchee
    entity_id: binary_sensor.vxkuhzkxzm4079619_batterie_branchee
    disabled_by_default: false    
    trigger_on_initial_state: true  
    on_state:
      then:
        - if:
            condition:
              binary_sensor.is_on: corsa_branchee
            then:
              - lvgl.label.update:
                  id: label_charge_corsa
                  text_color: COLOR_CSS_GOLDENROD
            else:
              - lvgl.label.update:
                  id: label_charge_corsa
                  text_color: COLOR_CSS_GREY
  # Infos 2008
  - platform: homeassistant
    name: e2008_pre_conditionnement
    id: e2008_pre_conditionnement
    entity_id: binary_sensor.vr3ukzkxznj706875_pre_conditionnement
    disabled_by_default: false
    trigger_on_initial_state: true
    on_state:
      then:
        lvgl.widget.update:
          id: btn_2008
          state:
            checked: !lambda return x;
  - platform: homeassistant
    name: e2008_branchee
    id: e2008_branchee
    entity_id: binary_sensor.vr3ukzkxznj706875_batterie_branchee
    disabled_by_default: false
    trigger_on_initial_state: true
    on_state:
      then:
        - if:
            condition:
              binary_sensor.is_on: e2008_branchee
            then:
              - lvgl.label.update:
                  id: label_charge_2008
                  text_color: COLOR_CSS_GOLDENROD
            else:
              - lvgl.label.update:
                  id: label_charge_2008
                  text_color: COLOR_CSS_GREY


sensor:
  # Sensor Wifi Signal
  - id: wifi_signal_db
    name: WiFi Signal
    platform: wifi_signal
    update_interval: 60s
    entity_category: diagnostic

  # Sensor Wifi Force
  - id: wifi_signal_strength
    name: WiFi Strength
    platform: copy
    source_id: wifi_signal_db
    filters:
      - lambda: return min(max(2 * (x + 100.0), 0.0), 100.0);
    unit_of_measurement: "%"
    entity_category: diagnostic

  # Sensor Température intérieure
  - platform: homeassistant
    id: thermostat_temp
    entity_id: sensor.chauffage_temperature_rdc_temperature
    disabled_by_default: false
    force_update: false
    accuracy_decimals: 1
    internal: true
    name: thermostat_temp
    on_value:
      - lvgl.label.update:
          id: screen_saver_temp
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: current_temp_label
          text:
            format: "\U000F050F%.1f°C"
            args: [ 'round(x * 10) / 10' ]

  # Sensor Météo Temp Max Aujourd'hui
  - platform: homeassistant
    name: meteo_temp_max
    entity_id: sensor.weather_logelheim_temp_max
    on_value:
      - lvgl.label.update:
          id: widget_meteo_temp_max
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_max_screen_saver
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_max_meteo_jour
          text:
            format: "%.1f°C"
            args: [ 'x' ]

  # Sensor Météo Temp Max Demain
  - platform: homeassistant
    name: meteo_temp_max
    entity_id: sensor.weather_logelheim_temp_max_demain
    on_value:
      - lvgl.label.update:
          id: widget_meteo_temp_max_meteo_demain
          text:
            format: "%.1f°C"
            args: [ 'x' ]

  # Sensor Météo Temp Min Aujourd'hui
  - platform: homeassistant
    name: meteo_temp_min
    entity_id: sensor.weather_logelheim_temp_min
    on_value:
      - lvgl.label.update:
          id: widget_meteo_temp_min
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_min_screen_saver
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_min_meteo_jour
          text:
            format: "%.1f°C"
            args: [ 'x' ]

  # Sensor Météo Temp Min Aujourd'hui
  - platform: homeassistant
    name: meteo_temp_min
    entity_id: sensor.weather_logelheim_temp_min_demain
    on_value:
      - lvgl.label.update:
          id: widget_meteo_temp_min_meteo_demain
          text:
            format: "%.1f°C"
            args: [ 'x' ]

  # Sensor Météo Temp Actuelle
  - platform: homeassistant
    name: meteo_temp_actuelle
    entity_id: sensor.bresser_station_meteo_temperature
    on_value:
      - lvgl.label.update:
          id: widget_meteo_temp_actuelle
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_actuelle_screen_saver
          text:
            format: "%.1f°C"
            args: [ 'x' ]
      - lvgl.label.update:
          id: widget_meteo_temp_actuelle_meteo_jour
          text:
            format: "%.1f°C"
            args: [ 'x' ]

  # Sensor Météo Humidité Actuelle
  - platform: homeassistant
    name: meteo_hum_actuelle
    entity_id: sensor.chauffage_temperature_rdc_humidity
    on_value:
      - lvgl.label.update:
          id: screen_saver_hum
          text:
            format: "%.1f%%"
            args: [ 'x' ]

  # Sensor Corsa Batterie %
  - platform: homeassistant
    name: corsa_batterie
    entity_id: sensor.vxkuhzkxzm4079619_batterie_niveau
    on_value:
      - lvgl.label.update:
          id: label_corsa_value
          text:
            format: "%.1f%%"
            args: [ 'x' ]

  # Sensor 2008 Batterie %
  - platform: homeassistant
    name: 2008_batterie
    entity_id: sensor.vr3ukzkxznj706875_niveau_batterie
    on_value:
      - lvgl.label.update:
          id: label_2008_value
          text:
            format: "%.1f%%"
            args: [ 'x' ]

  # Sensor Température ESP
  - platform: internal_temperature
    name: "Temp ESP"

  # Sensor Uptime
  - platform: uptime
    name: "Uptime"

  # Sensor Heap
  - platform: debug
    free:
      name: "Heap libre"

  # HA Climate Temperature de consigne
  - platform: homeassistant
    entity_id: climate.chauffage_maison
    id: set_temperature
    attribute: temperature
    internal: true
    on_value:
      - lvgl.indicator.update:
          id: hvac_temp_ticks
          end_value: !lambda return x * 10;
      - lvgl.arc.update:
          id: hvac_temp_knob
          value: !lambda return x * 10;
      - lvgl.label.update:
          id: hvac_temp_label
          text:
            format: "%.1f°C"
            args: [ 'round(x * 10) / 10' ]

  # HA Climate Température actuelle
  - platform: homeassistant
    entity_id: climate.chauffage_maison
    id: current_temperature
    attribute: current_temperature
    internal: true
    on_value:
      - lvgl.indicator.update:
          id: current_temp_needle
          value: !lambda return x * 10;
      #- lvgl.label.update:
      #    id: current_temp_label
      #    text:
      #      format: "\U000F050F%.1f°C"
      #      args: [ 'round(x * 10) / 10' ]


text_sensor:
  # Texte Info Wifi adresse IP / SSID / MAC
  - platform: wifi_info
    ip_address:
      name: IP Address
      entity_category: diagnostic
    ssid:
      name: Connected SSID
      entity_category: diagnostic
    mac_address:
      name: Mac Address
      entity_category: diagnostic

  # Texte Etat de l'alarme
  - platform: homeassistant
    id: alarm_state
    entity_id: alarm_control_panel.alarmo
    internal: true
    name: alarm_state
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(alarm_state).state == "armed_away";'
            then:
              - lvgl.led.update:
                  id: lvgl_led
                  color: COLOR_CSS_RED
              - lvgl.led.update:
                  id: lvgl_led2
                  color: COLOR_CSS_RED
        - if:
            condition:
              lambda: 'return id(alarm_state).state == "arming";'
            then:
              - lvgl.led.update:
                  id: lvgl_led
                  color: COLOR_CSS_ORANGE
              - lvgl.led.update:
                  id: lvgl_led2
                  color: COLOR_CSS_ORANGE
        - if:
            condition:
              lambda: 'return id(alarm_state).state == "disarmed";'
            then:
              #- switch.turn_on: screen_saver
              - lvgl.led.update:
                  id: lvgl_led
                  color: COLOR_CSS_LIMEGREEN
              - lvgl.led.update:
                  id: lvgl_led2
                  color: COLOR_CSS_LIMEGREEN
            else:
              #- switch.turn_off: screen_saver
              #- lvgl.page.show: page_alarme_active
              - script.execute:
                  id: screen_saver_alarm
        #- script.execute:
        #    id: script_screen_saver_alarme

  # Texte Météo Icone Condition Aujourd'hui
  - platform: homeassistant
    name: meteo_condition_icon
    entity_id: input_text.weather_esp_icon
    on_value:
      - lvgl.label.update:
          id: widget_meteo_condition_icon
          text: !lambda |-
              return x.c_str();
      - lvgl.label.update:
          id: widget_meteo_condition_icon_screen_saver
          text: !lambda |-
              return x.c_str();
      - lvgl.label.update:
          id: widget_meteo_condition_icon_meteo_jour
          text: !lambda |-
              return x.c_str();

  # Texte Météo Icone Condition Demain
  - platform: homeassistant
    name: meteo_condition_icon
    entity_id: input_text.weather_esp_icon_demain
    on_value:
      - lvgl.label.update:
          id: widget_meteo_condition_icon_meteo_demain
          text: !lambda |-
              return x.c_str();

  # Texte Météo Icone Nom Aujourd'hui
  - platform: homeassistant
    name: meteo_condition_name
    entity_id: input_text.weather_esp_name
    on_value:
      - lvgl.label.update:
          id: widget_meteo_condition_name
          text: !lambda |-
              return x.c_str();
      - lvgl.label.update:
          id: widget_meteo_condition_name_screen_saver
          text: !lambda |-
              return x.c_str();
      - lvgl.label.update:
          id: widget_meteo_condition_name_meteo_jour
          text: !lambda |-
              return x.c_str();

  # Texte Météo Icone Nom Demain
  - platform: homeassistant
    name: meteo_condition_name
    entity_id: input_text.weather_esp_name_demain
    on_value:
      - lvgl.label.update:
          id: widget_meteo_condition_name_meteo_demain
          text: !lambda |-
              return x.c_str();

  # HA Climate HVAC preset
  - platform: homeassistant
    entity_id: climate.chauffage_maison
    id: preset_mode
    attribute: preset_mode
    internal: true
    on_value:
      then:
        - script.execute:
            id: set_hvac_preset
            mode: !lambda return x;

  # HA Climate HVAC mode
  - platform: homeassistant
    entity_id: climate.chauffage_maison
    id: hvac_mode
    attribute: hvac_action
    internal: true
    on_value:
      then:
        - script.execute:
            id: set_hvac_mode
            mode: !lambda return x;

globals:
  - id: homeassistant_ip
    type: std::string
  - id: scroll
    type: int
    restore_value: no
    initial_value: '0'
  - id: scroll_x
    type: int
    restore_value: no
    initial_value: '0'
  - id: scroll_y
    type: int
    restore_value: no
    initial_value: '0'


#output:

#light:

#display:

#touchscreen:

#time:

# -------------------------------------------------------------------
# FILES
# -------------------------------------------------------------------
image:
  - file: /config/esphome/logo.png
    id: boot_logo
    resize:
      - 200
      - 200
    type: RGB565
    transparency: alpha_channel
    dither: NONE
    invert_alpha: false


# -------------------------------------------------------------------
# SCRIPTS
# -------------------------------------------------------------------
script:
  - id: go_home
    then:
      - lvgl.page.show:
          id: home
          #animation: LV_SCR_LOAD_ANIM_NONE
          animation: MOVE_LEFT
          time: ${page_anim_time}
    mode: single
    parameters: {}


  - id: screen_saver_alarm
    then: 
      - if:
          condition:
            lambda: 'return id(alarm_state).state == "disarmed";'
          then:
            - if:
                condition:
                  and:
                    - switch.is_on:
                        id: screen_saver
                then:
                  #- switch.turn_on: screen_saver
                  - lvgl.page.show: page_screen_saver
          else:
            - lvgl.page.show: page_alarme_active

  - id: script_screen_saver_alarme
    then:
      - if:
          condition:
            lambda: 'return id(alarm_state).state == "disarmed";'
          then:
            - if:
                condition:
                  and:
                    - switch.is_on:
                        id: screen_saver
                then:
                  - switch.turn_on: screen_saver
            #- lvgl.widget.hide: navbar
            #- lvgl.widget.hide: titlebar
            #- light.turn_on:
            #    id: display_backlight
            #    brightness: !lambda 'return 0.34;'
          else:
            - switch.turn_off: screen_saver
            - lvgl.widget.show: navbar
            - lvgl.widget.show: titlebar
            - light.turn_on:
                id: display_backlight
                brightness: !lambda 'return 1;'
            - lvgl.page.show: page_alarme_active

  # Set HVAC Temperature UI scripts
  - id: set_hvac_temp
    parameters:
      direction: string
    then:
      - homeassistant.action:
          action: climate.set_temperature
          data:
            entity_id: climate.chauffage_maison
            temperature: !lambda |-
              float current_temp = id(set_temperature).state;
              if (direction == "up") {
                return current_temp + 0.5;
              } else {
                return current_temp - 0.5;
              }

  # HVAC Modes UI scripts
  - id: set_hvac_mode
    parameters:
      mode: string
    then:
      - lvgl.label.update:
          id: power_button_label
          text_color: ${color_grey}
      - lvgl.label.update:
          id: heat_button_label
          text_color: ${color_grey}
      # Mode Label update
      - if:
          condition:
            lambda: 'return (mode == "off");'
          then:
            - lvgl.label.update:
                id: power_button_label
                text_color: ${color_success}
            - lvgl.label.update:
                id: heat_button_label
                text_color: ${color_grey}
            - lvgl.label.update:
                id: mode_label
                text: "ETEINT"
      - if:
          condition:
            lambda: 'return (mode == "heating");'
          then:
            - lvgl.label.update:
                id: power_button_label
                text_color: ${color_grey}
            - lvgl.label.update:
                id: heat_button_label
                text_color: ${color_success}
            - lvgl.label.update:
                id: mode_label
                text: "CHAUFFE"
      - if:
          condition:
            lambda: 'return (mode == "idle");'
          then:
            - lvgl.label.update:
                id: power_button_label
                text_color: ${color_grey}
            - lvgl.label.update:
                id: heat_button_label
                text_color: ${color_success}
            - lvgl.label.update:
                id: mode_label
                text: "PAUSE"

  # HVAC Presets UI scripts
  - id: set_hvac_preset
    parameters:
      mode: string
    then:
      - lvgl.label.update:
          id: away_button_label
          text_color: ${color_grey}
      - lvgl.label.update:
          id: comfort_button_label
          text_color: ${color_grey}
      - lvgl.label.update:
          id: home_button_label
          text_color: ${color_grey}
      # Preset Label update
      - if:
          condition:
            lambda: 'return (mode == "off");'
          then:
            - lvgl.label.update:
                id: hvac_temp_label
                text_color: ${color_grey}
          else:
            - lvgl.label.update:
                id: hvac_temp_label
                text_color: COLOR_CSS_WHITE
      - if:
          condition:
            lambda: 'return mode == "away";'
          then:
            - lvgl.label.update:
                id: away_button_label
                text_color: ${color_success}
      - if:
          condition:
            lambda: 'return mode == "comfort";'
          then:
            - lvgl.label.update:
                id: comfort_button_label
                text_color: ${color_success}
      - if:
          condition:
            lambda: 'return mode == "home";'
          then:
            - lvgl.label.update:
                id: home_button_label
                text_color: ${color_success}



# -------------------------------------------------------------------
# LVGL / AFFICHAGES DES PAGES
# -------------------------------------------------------------------
lvgl:
  - default_font: roboto_principal
    bg_color: COLOR_CSS_SKYBLUE
    text_color: COLOR_CSS_WHITE
    scrollbar_mode: "OFF"

    theme: !include ecran_guition/my_theme.yaml
    top_layer: !include ecran_guition/top_layer.yaml
    
    # MESSAGES BOXES
    msgboxes:
      # Msg box chauffage RdC
      - id: message_box_chauffage_rdc
        close_button: false
        title: REZ-DE-CHAUSSEE
        text_font: roboto_principal
        button_style:
          width: 130
          height: 45        
        body:
          text: "Modifier le chauffage au rez-de-chaussée ?"
          bg_color: COLOR_CSS_GREY
        widgets:
          - buttonmatrix:
              width: 230
              height: 45
              items:
                bg_color: COLOR_CSS_GREY
                pressed:
                  bg_color: 0xFFFF00
              #id: matrix_id
              rows:
                - buttons:
                  - id: msgbox_rdc_ok
                    text: "OK"
                    on_click:
                      then:
                        - homeassistant.action:
                            action: switch.toggle
                            data:
                              entity_id: switch.chauffage_relais_x2_right
                        - lvgl.widget.hide: message_box_chauffage_rdc
                  - id: msgbox_rdc_cancel
                    text: "ANNULER"
                    on_click:
                      then:
                        - lvgl.widget.hide: message_box_chauffage_rdc

      # Msg box chauffage Etage
      - id: message_box_chauffage_etage
        close_button: false
        text_font: roboto_principal
        title: ETAGE
        button_style:
          width: 130
          height: 45
        body:
          text: "Modifier le chauffage de l'étage ?"
          bg_color: COLOR_CSS_GREY
        widgets:
          - buttonmatrix:
              width: 230
              height: 45
              items:
                bg_color: COLOR_CSS_GREY
                pressed:
                  bg_color: 0xFFFF00
              #id: matrix_id
              rows:
                - buttons:
                  - id: msgbox_etage_ok
                    width: 130
                    text: "OK"
                    on_click:
                      then:
                        - homeassistant.action:
                            action: switch.toggle
                            data:
                              entity_id: switch.chauffage_relais_x2_left
                        - lvgl.widget.hide: message_box_chauffage_etage
                  - id: msgbox_etage_cancel
                    width: 130
                    text: "ANNULER"
                    on_click:
                      then:
                        - lvgl.widget.hide: message_box_chauffage_etage


    style_definitions:
      # Style boutons CHAUFFAGE MODE
      - id: style_mode_button
        bg_color: ${color_darker_grey}
        radius: 50
        outline_width: 1
        height: 45
        width: 125
        align: BOTTOM_MID
      - id: style_mode_button_label
        align: CENTER
        y: 2
        text_font: roboto_icon_thermostat_preset
      # Style boutons CHAUFFAGE PRESET
      - id: style_preset_button
        bg_color: ${color_darker_grey}
        radius: 50
        outline_width: 1
        height: 45
        width: 80
        align: BOTTOM_MID
      - id: style_preset_button_label
        align: CENTER
        y: 2
        text_font: roboto_icon_thermostat_preset
      # Style boutons CHAUFFAGE TEMPERATURE
      - id: style_circle_button
        bg_color: ${color_darker_grey}
        radius: 75
        outline_width: 1
        width: 50
        height: 50
      - id: style_circle_label
        align: center
        y: 0
        text_align: center
        text_font: roboto_principal
      # Style boutons CHAUFFAGE MANUEL
      - id: style_switch_chauff_button
        bg_color: ${color_darker_grey}
        radius: 50
        outline_width: 1
        height: 85
        width: 90
        align: BOTTOM_MID
      - id: style_switch_chauff_button_label
        align: CENTER
        y: 0
        text_font: icon_chauffage
      - id: style_dropdown_preset
        bg_color: ${color_darker_grey}
        height: 45
        width: 140
        radius: 50
        outline_width: 1
        align: CENTER
        text_font: roboto_icon_thermostat_preset
        text_color: white
      # Style boutons PRE-CONDITIONNEMENT 
      - id: style_circle_button_pre_conditionnement
        #bg_color: ${color_darker_grey}
        radius: 75
        outline_width: 1
      - id: style_circle_label_pre_conditionnement
        align: center
        y: 0
        text_align: center
        text_font: roboto_principal

    on_idle:
      timeout: !lambda "return (id(display_timeout).state * 1000);"
      then:
        - script.execute:
            id: screen_saver_alarm
          #- if:
          #    condition:
          #      and:
          #        - switch.is_on:
          #            id: screen_saver
          #    then:
                #- logger.log: "LVGL en pause"
                #- script.execute:
                #    id: script_screen_saver_alarme
                #- lvgl.page.show: page_screen_saver
              #else:
              #  - logger.log: "LVGL allumé"

    pages:
      - id: splash
        bg_color: COLOR_CSS_SKYBLUE
        skip: true
        on_load:
          - then:
              - script.execute:
                  id: go_home

      # Page PARAMETRES
      - id: page_param
        bg_color: COLOR_CSS_SKYBLUE
        widgets:
          - switch:
              x: 10
              y: 10
              id: screen_saver_param

      # Page CHAUFFAGE
      - id: page_chauffage
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: CHAUFFAGE
        widgets:
          - tabview:
              id: tabview
              position: top
              align: CENTER
              height: 80%
              bg_color: COLOR_CSS_SKYBLUE
              tabs:
                # TAB GESTION PAR THERMOSTAT
                - name: THERMOSTAT
                  id: tabview_thermostat
                  widgets:
                    # Arc extérieur pour effet visuel
                    - arc:
                        id: arc_ring_outer
                        height: 200
                        width: 200
                        x: -50
                        y: -55
                        align: CENTER
                        arc_color: ${color_light_grey}
                        arc_opa: COVER
                        arc_width: 10
                        arc_rounded: true
                        knob:
                          bg_color: COLOR_CSS_WHITE
                    # Arc intérieur pour effet visuel
                    - obj:
                        id: arc_ring_inner
                        height: 180
                        width: 180
                        x: -50
                        y: -55
                        radius: 120
                        align: CENTER
                        border_width: 40
                        border_color: ${color_dark_grey}
                        bg_color: ${color_darker_grey}
                    # Meter ticks and needle
                    - meter:
                        id: meter_ticks
                        hidden: false
                        height: 198
                        width: 198
                        x: -50
                        y: -55
                        align: CENTER
                        bg_opa: TRANSP
                        border_width: 0
                        scales:
                          range_from: 160   # 16°C
                          range_to: 340     # 34°C
                          # Set temperature ticks background
                          ticks:
                            count: 60
                            length: 18
                            width: 2
                            color: ${color_temp_ticks}
                          indicators:
                            # Curremt temperature needle
                            - line:
                                id: current_temp_needle
                                color: ${color_temp_current}
                                width: 3
                                r_mod: 10
                                value: 340 # 34°C Should be the same as the current temperature label
                            # Set temperature ticks
                            - tick_style:
                                id: hvac_temp_ticks
                                start_value: 160
                                end_value: 240 # 24°C Should be the same as the set temperature label
                                color_start: ${color_temp_set}
                                color_end: ${color_temp_set}
                                width: 2
                    # Meter intérieur pour effet visuel
                    - obj:
                        id: meter_ring_inner
                        height: 140
                        width: 140
                        x: -50
                        y: -55
                        radius: 120
                        align: CENTER
                        border_width: 12
                        border_color: ${color_dark_grey}
                        bg_color: ${color_darker_grey}
                    # Set temperature knob, should change with the set temperature ticks
                    - arc:
                        id: hvac_temp_knob
                        hidden: false
                        align: CENTER
                        arc_opa: TRANSP
                        adjustable: false
                        value: 240 # 24°C (24x10) Should be the same as the set temperature needle
                        min_value: 160
                        max_value: 340
                        width: 180
                        height: 180
                        x: -50
                        y: -55
                        arc_width: 16
                        change_rate: 30
                        indicator:
                          arc_opa: TRANSP
                          arc_width: 16
                        knob:
                          bg_color: ${color_temp_set}
                          border_width: 4
                          border_color: COLOR_CSS_WHITE

                    # HVAC Mode actuel: AWAY, COMFORT, HOME
                    - label:
                        id: mode_label
                        align: CENTER
                        x: -50
                        y: -75
                        text: "KPR" # HVAC mode to be updated from Home Assistant climate entity
                        text_font: roboto_principal
                        text_color: ${color_grey}
                    # Temperature de consigne
                    - label:
                        id: hvac_temp_label
                        hidden: false
                        align: CENTER
                        x: -50
                        y: -45
                        text_font: roboto_xl
                        text: "---" # Set temperature to be updated from Home Assistant climate entity
                    # Temperature actuelle
                    - label:
                        id: current_temp_label
                        hidden: false
                        align: CENTER
                        x: -50
                        y: 15
                        text: "---" # Current temperature to be updated from Home Assistant climate entity
                        text_color: ${color_temp_current}

                    # Boutons de réglages temperature
                    # HVAC bouton +
                    - button:
                        id: temp_inc_button
                        hidden: false
                        x: 100
                        y: -120
                        align: CENTER
                        styles: style_circle_button
                        widgets:
                          - label:
                              styles: style_circle_label
                              text: ${mdi_plus}
                              text_font: icon_chauffage
                        on_press:
                          - script.execute:
                              id: set_hvac_temp
                              direction: "up"
                    # Icone Temperature
                    - label:
                        id: temp_label
                        hidden: false
                        align: CENTER
                        x: 100
                        y: -60
                        text_align: CENTER
                        text: ${mdi_thermometer}
                        text_font: icon_chauffage
                        text_color: COLOR_CSS_RED
                    # HVAC bouton -
                    - button:
                        id: temp_dec_button
                        hidden: false
                        x: 100
                        y: 0
                        align: CENTER
                        styles: style_circle_button
                        widgets:
                          - label:
                              styles: style_circle_label
                              text: ${mdi_minus}
                              text_font: icon_chauffage
                        on_press:
                          - script.execute:
                              id: set_hvac_temp
                              direction: "down"

                    # HVAC POWER
                    # POWER
                    - button:
                        id: power_button
                        x: -67
                        y: 70
                        styles: style_mode_button
                        align: CENTER
                        widgets:
                          - label:
                              id: power_button_label
                              styles: style_mode_button_label
                              text: ${mdi_power} 
                              text_color: ${color_grey}
                        on_press:
                          then:
                            - homeassistant.action:
                                action: climate.set_hvac_mode
                                data:
                                  entity_id: climate.chauffage_maison
                                  hvac_mode: "off"
                    # HEAT
                    - button:
                        id: heat_button
                        x: 67
                        y: 70
                        styles: style_mode_button
                        align: CENTER
                        widgets:
                          - label:
                              id: heat_button_label
                              styles: style_mode_button_label
                              text: ${mdi_fire} 
                              text_color: ${color_grey}
                        on_press:
                          - homeassistant.action:
                              action: climate.set_hvac_mode
                              data:
                                entity_id: climate.chauffage_maison
                                hvac_mode: "heat"
                          
                    # PRESET AWAY
                    - button:
                        id: away_button
                        align: CENTER
                        x: -90
                        y: 135
                        styles: style_preset_button
                        widgets:
                          - label:
                              id: away_button_label
                              styles: style_preset_button_label
                              text: ${mdi_away}
                              text_color: ${color_grey}
                        on_press:
                          - homeassistant.action:
                              action: climate.set_preset_mode
                              data:
                                entity_id: climate.chauffage_maison
                                preset_mode: "away"
                    # PRESET COMFORT
                    - button:
                        id: comfort_button
                        align: CENTER
                        x: 0
                        y: 135
                        styles: style_preset_button
                        widgets:
                          - label:
                              id: comfort_button_label
                              styles: style_preset_button_label
                              text: ${mdi_sofa}
                              text_color: ${color_grey}
                        on_press:
                          - homeassistant.action:
                              action: climate.set_preset_mode
                              data:
                                entity_id: climate.chauffage_maison
                                preset_mode: "comfort"
                    # PRESET HOME
                    - button:
                        id: home_button
                        align: CENTER
                        x: 90
                        y: 135
                        styles: style_preset_button
                        widgets:
                          - label:
                              id: home_button_label
                              styles: style_preset_button_label
                              text: ${mdi_home}
                              text_color: ${color_grey}
                        on_press:
                          - homeassistant.action:
                              action: climate.set_preset_mode
                              data:
                                entity_id: climate.chauffage_maison
                                preset_mode: "home"

                # TAB GESTION MANUELLE
                - name: MANUEL
                  id: tabview_manuel
                  bg_color: COLOR_CSS_SKYBLUE
                  widgets:
                    # BOUTONS DE GESTION MANUELLE
                    - obj:
                        align: CENTER
                        width: 100%
                        height: 100%
                        pad_all: 1
                        bg_opa: TRANSP
                        border_opa: TRANSP
                        layout: 
                          type: GRID 
                          grid_columns: [FR(1), FR(1)]
                          grid_rows: [FR(1), FR(1), FR(1)]
                          pad_row: 6
                          pad_column: 8
                        widgets:
                          # Interrupteur Rez de chaussée
                          - button:
                              bg_color: COLOR_CSS_DARKBLUE
                              id: rdc_button
                              grid_cell_column_pos: 0
                              grid_cell_row_pos: 0
                              grid_cell_x_align: STRETCH
                              grid_cell_y_align: STRETCH
                              widgets:
                                - label:
                                    id: rdc_button_label
                                    styles: style_switch_chauff_button_label
                                    text: ${icon_floor_0}
                                    text_color: ${color_grey}
                              on_click:
                                then:
                                  - lvgl.widget.show: message_box_chauffage_rdc
                          # Interrupteur Etage
                          - button:
                              bg_color: COLOR_CSS_DARKBLUE
                              id: etage_button
                              grid_cell_column_pos: 1
                              grid_cell_row_pos: 0
                              grid_cell_x_align: STRETCH
                              grid_cell_y_align: STRETCH
                              widgets:
                                - label:
                                    id: etage_button_label
                                    styles: style_switch_chauff_button_label
                                    text: ${icon_floor_1}
                                    text_color: ${color_grey}
                              on_click:
                                then:
                                  - lvgl.widget.show: message_box_chauffage_etage
                          # Interrupteur Gainable
                          - button:
                              bg_color: COLOR_CSS_DARKBLUE
                              id: gainable_button
                              grid_cell_column_pos: 0
                              grid_cell_row_pos: 2
                              grid_cell_x_align: STRETCH
                              grid_cell_y_align: STRETCH
                              widgets:
                                - label:
                                    id: gainable_button_label
                                    styles: style_switch_chauff_button_label
                                    text: ${icon_floor_Air_Cond}
                                    text_color: ${color_grey}
                              #on_click:
                              #  then:
                              #    - lvgl.widget.show: message_box_chauffage_rdc

      # Page ALARME OFF
      - id: page_alarme_inactive
        bg_color: COLOR_CSS_SKYBLUE
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: ALARME
        widgets:
          - obj:
              align: TOP_MID
              x: 0
              y: 50
              width: lv_pct(95)
              height: lv_pct(60)
              #pad_all: 15
              bg_opa: TRANSP
              border_opa: TRANSP
              layout:
                type: GRID
                grid_columns: [FR(10), FR(60), FR(10)]
                grid_rows: [FR(25), FR(50), FR(25)]
                pad_row: 14
                pad_column: 8
              widgets:
                - label:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    text: "ALARME"
                    text_font: roboto_xl
                - led:
                    id: lvgl_led2
                    grid_cell_column_pos: 2
                    grid_cell_row_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    color: COLOR_CSS_RED
                    brightness: 70%
                - button:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 1
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    id: button_alarme
                    checkable: false
                    widgets:
                      - label:
                          align: center
                          text: ${mdi_security}
                          text_font: icon_chauffage
                          id: button_alarme_text
                    on_click:
                      - homeassistant.action:
                          action: script.turn_on
                          data:
                            entity_id: script.alarmo_on_script
                      - lvgl.page.show: page_alarme_active
                - button:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 2
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    checkable: false
                    widgets:
                      - label:
                          align: center
                          text: ${mdi_keyboard}
                          text_font: icon_chauffage
                    on_click:
                      - lvgl.page.show: 
                          id: page_alarme_active
                          animation: MOVE_RIGHT
                          time: ${page_anim_time}


          - obj:
              align: TOP_MID
              x: 0
              y: 360
              width: lv_pct(95)
              height: lv_pct(13)
              #pad_all: 6
              bg_color: COLOR_CSS_WHITE
              border_opa: TRANSP
              layout:
                type: GRID
                grid_columns: [FR(4), FR(70), FR(20), FR(4)]
                grid_rows: [FR(1)]
                pad_row: 6
                pad_column: 8
              widgets:
                - label:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 0
                    grid_cell_x_align: START
                    grid_cell_y_align: CENTER
                    id: camera_state_titre
                    text: "CAMERA"
                - switch:
                    grid_cell_column_pos: 2
                    grid_cell_row_pos: 0
                    grid_cell_x_align: END
                    grid_cell_y_align: CENTER
                    id: camera_state__switch
                    on_click:
                      - homeassistant.action:
                          action: script.turn_on
                          data:
                            entity_id: script.securite_camera_switch

      # Page ALARME ON
      - id: page_alarme_active
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: ALARME
        widgets:
          - led:
              id: lvgl_led
              x: 25
              y: 67
              color: COLOR_CSS_RED
              brightness: 70%
          - obj:
              width: 240
              height: 35
              align_to:
                id: lvgl_led
                align: OUT_RIGHT_MID
                x: 17
              border_width: 1
              border_color: 0
              border_opa: 50%
              pad_all: 0
              bg_opa: 80%
              bg_color: COLOR_CSS_WHITE
              shadow_color: 0
              shadow_opa: 50%
              shadow_width: 10
              shadow_spread: 3
              radius: 5
              widgets:
                - label:
                    id: lvgl_label
                    align: CENTER
                    text: "code"
                    text_align: CENTER
          - buttonmatrix:
              id: lvgl_keypad
              x: 10
              y: 110
              width: 300
              height: 290
              
              items:
                text_font: roboto_icon_thermostat_preset
                pressed:
                  bg_color: COLOR_CSS_YELLOW
              rows:
                - buttons:
                    - text: 1
                      control:
                        no_repeat: true
                    - text: 2
                      control:
                        no_repeat: true
                    - text: 3
                      control:
                        no_repeat: true
                - buttons:
                    - text: 4
                      control:
                        no_repeat: true
                    - text: 5
                      control:
                        no_repeat: true
                    - text: 6
                      control:
                        no_repeat: true
                - buttons:
                    - text: 7
                      control:
                        no_repeat: true
                    - text: 8
                      control:
                        no_repeat: true
                    - text: 9
                      control:
                        no_repeat: true
                - buttons:
                    - text: ${mdi_backspace}
                      key_code: "*"
                      control:
                        no_repeat: true
                    - text: 0
                      control:
                        no_repeat: true
                    - text: ${mdi_checkbold}
                      key_code: "#"
                      control:
                        no_repeat: true

      # Page DIVERS
      - id: page_divers
        bg_color: COLOR_CSS_SKYBLUE
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: DIVERS
        widgets:
          - obj:
              scrollbar_mode: "OFF"
              align: CENTER
              width: lv_pct(90)
              height: lv_pct(75)
              pad_all: 4
              bg_color: COLOR_CSS_WHITE
              #bg_opa: TRANSP
              border_opa: TRANSP
              layout: 
                type: GRID 
                grid_columns: [FR(6), FR(3), FR(3), FR(3)]
                grid_rows: [FR(10), FR(1), FR(10), FR(10), FR(1), FR(10), FR(10), FR(1), FR(10), FR(10), FR(10)]
                pad_row: 4
                pad_column: 4
              widgets:
                # Switch Lumière Atelier
                - label:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 0
                    grid_cell_column_span: 3
                    grid_cell_x_align: START
                    grid_cell_y_align: CENTER
                    id: button_lumiere_atelier_titre
                    text: "LUMIERE ATELIER"
                    align: CENTER
                - switch:
                    grid_cell_column_pos: 3
                    grid_cell_row_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    id: button_lumiere_atelier_switch
                    align: CENTER
                    on_click:
                      - homeassistant.action:
                          action: switch.toggle
                          data:
                            entity_id: switch.automatisme_atelier_lumiere_switch

                # Ligne de séparation
                - line:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 1
                    grid_cell_column_span: 4
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    points:
                      - 0, 0
                      - 270, 0
                    line_width: 4
                    line_color: COLOR_CSS_BLUE
                    line_rounded: true

                # Informations Corsa
                - label:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 2
                    grid_cell_column_span: 3
                    grid_cell_x_align: START
                    grid_cell_y_align: CENTER
                    id: label_corsa_titre
                    text: "CORSA-E"
                    align: CENTER
                - label:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 3
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    id: label_corsa_value
                    align: CENTER
                - label:
                    id: label_charge_corsa
                    grid_cell_column_pos: 2
                    grid_cell_row_pos: 3
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    align: CENTER
                    text: ${mdi_ev_plug_type2} #"\U000F151E"
                    text_color: COLOR_CSS_GREY
                - button:
                    grid_cell_column_pos: 3
                    grid_cell_row_pos: 3
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    id: btn_corsa
                    align: CENTER
                    styles: style_circle_button_pre_conditionnement
                    widgets:
                      - label:
                          align: CENTER
                          text: ${mdi_defrost} #"\U000F0D61"
                    on_click:
                      - homeassistant.action:
                          action: button.press
                          data:
                            entity_id: button.vxkuhzkxzm4079619_preconditionnement_demarrer

                # Ligne de séparation
                - line:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 4
                    grid_cell_column_span: 4
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    points:
                      - 0, 0
                      - 270, 0
                    line_width: 4
                    line_color: COLOR_CSS_BLUE
                    line_rounded: true
                
                # Informations 2008
                - label:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 5
                    grid_cell_column_span: 3
                    grid_cell_x_align: START
                    grid_cell_y_align: CENTER
                    id: label_2008_titre
                    text: "E2008"
                    align: CENTER
                - label:
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 6
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    id: label_2008_value
                    align: CENTER
                - label:
                    id: label_charge_2008
                    grid_cell_column_pos: 2
                    grid_cell_row_pos: 6
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    align: CENTER
                    text: ${mdi_ev_plug_type2} #"\U000F151E"
                    text_color: COLOR_CSS_GREY
                - button:
                    grid_cell_column_pos: 3
                    grid_cell_row_pos: 6
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    id: btn_2008
                    align: CENTER
                    styles: style_circle_button_pre_conditionnement
                    widgets:
                      - label:
                          align: CENTER
                          text: ${mdi_defrost} #"\U000F0D61"
                    on_click:
                      - homeassistant.action:
                          action: button.press
                          data:
                            entity_id: button.vr3ukzkxznj706875_preconditionnement_demarrer

                # Ligne de séparation
                - line:
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 7
                    grid_cell_column_span: 4
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: CENTER
                    points:
                      - 0, 0
                      - 270, 0
                    line_width: 4
                    line_color: COLOR_CSS_BLUE
                    line_rounded: true

      # Page SCREEN SAVER
      - id: page_screen_saver
        bg_color: COLOR_CSS_BLACK
        on_load:
          - then:
              - lvgl.widget.hide: navbar
              - lvgl.widget.hide: titlebar
              - light.turn_on:
                  id: display_backlight
                  brightness: !lambda 'return 0.34;'
        widgets:
          # AFFICHAGE TEMPERATURE / HUMIDITE
          - obj:
              align: CENTER
              width: lv_pct(100)
              height: lv_pct(100)
              pad_all: 6
              bg_color: COLOR_CSS_BLACK
              widgets:
                - label:
                    align: CENTER
                    y: 50
                    id: screen_saver_temp
                    text: ' '
                    text_color: COLOR_CSS_WHITE
                    text_font: roboto_xxl
                - label:
                    align: CENTER
                    x: 90
                    y: 115
                    id: screen_saver_hum
                    text: ' '
                    text_color: COLOR_CSS_WHITE
                    text_font: roboto_xl
                - label:
                    align: CENTER
                    y: 210
                    id: screen_saver_heure
                    text: ' '
                    text_color: COLOR_CSS_WHITE
                    text_font: heure_screen_saver
                    
              on_short_click:
                then:
                  - lvgl.page.show: home
                  - lvgl.widget.show: navbar
                  - lvgl.widget.show: titlebar
                  - light.turn_on:
                      id: display_backlight
                      brightness: !lambda 'return 1;'

          # AFFICHAGE ICONE TEMPERATURE DU JOUR
          - obj:
              align: CENTER
              x: 75
              y: -150
              width: 140
              height: 140
              pad_all: 10
              bg_color: COLOR_CSS_BLACK
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(2), FR(1)]
                grid_columns: [FR(1)]
              widgets:
                - label:
                    text: "..."
                    id: widget_meteo_condition_icon_screen_saver
                    text_font: icons_page_screen_saver
                    text_color: COLOR_CSS_WHITE
                    text_align: CENTER
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: STRETCH
                - label:
                    text: "Unknown"
                    id: widget_meteo_condition_name_screen_saver
                    text_align: CENTER
                    text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 0
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: CENTER
              on_short_click:
                then:
                  - lvgl.page.show: home
                  - lvgl.widget.show: navbar
                  - lvgl.widget.show: titlebar
                  - light.turn_on:
                      id: display_backlight
                      brightness: !lambda 'return 1;'

          # AFFICHAGE TEMPERATURE DU JOUR
          - obj:
              align: CENTER
              bg_color: COLOR_CSS_BLACK
              x: -75
              y: -150
              width: 140
              height: 140
              pad_all: 10
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(1), FR(1), FR(1), FR(1)]
                grid_columns: [FR(1), FR(1)]
              widgets:
                - label:
                    text: "--.- °C"
                    text_font: meteo_actuelle_screen_saver
                    text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_actuelle_screen_saver
                    text_align: RIGHT
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_column_span: 2
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Max:"
                    text_font: meteo_min_max_screen_saver
                    text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_max_screen_saver
                    text_align: RIGHT
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Min:"
                    text_font: meteo_min_max_screen_saver
                    text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_min_screen_saver
                    text_align: RIGHT
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH
              on_short_click:
                then:
                  - lvgl.page.show: home
                  - lvgl.widget.show: navbar
                  - lvgl.widget.show: titlebar
                  - light.turn_on:
                      id: display_backlight
                      brightness: !lambda 'return 1;'

      # Page TEMPORAIRE
      - id: page_tmp
        widgets:
          - obj:
              align: CENTER
              width: lv_pct(80)
              height: lv_pct(30)
              #width: 228
              #height: 320
              pad_all: 10
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(48), FR(13), FR(13), FR(13), FR(13)]
                grid_columns: [FR(10), FR(40), FR(40), FR(10)]
              widgets:
                - label:
                    text: "\U000F14E4"
                    id: widget_meteo_condition_icon
                    text_font: icons_page_meteo
                    text_align: CENTER
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_column_span: 2
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: START

                - label:
                    text: "Unknown"
                    id: widget_meteo_condition_name
                    text_align: CENTER
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 2
                    grid_cell_column_span: 2
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: CENTER

                - label:
                    text: "Actuelle:"
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 1

                - label:
                    text: "--.- °C"
                    id: widget_meteo_temp_actuelle
                    text_align: RIGHT
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 2
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Maximum:"
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 1

                - label:
                    text: "--.- °C"
                    id: widget_meteo_temp_max
                    text_align: RIGHT
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 2
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Minimum:"
                    grid_cell_row_pos: 4
                    grid_cell_column_pos: 1

                - label:
                    text: "--.- °C"
                    id: widget_meteo_temp_min
                    text_align: RIGHT
                    grid_cell_row_pos: 4
                    grid_cell_column_pos: 2
                    grid_cell_x_align: STRETCH
          # HVAC Liste de choix du preset
          - dropdown:
              id: dropdown_preset
              x: 100
              y: -70
              options:
                - "${mdi_away} (16)"
                - "${mdi_sofa} (23)"
                - "${mdi_home} (21)"
              #styles: style_dropdown_preset
              bg_color: ${color_darker_grey}
              height: 45
              width: 90
              radius: 50
              outline_width: 1
              align: CENTER
              text_font: roboto_principal
              text_color: white
              selected_index: 1
              symbol: ${mdi_chevron_down}
              dropdown_list:
                selected:
                  checked:
                    text_color: ${color_success}
              on_value:
                - homeassistant.action:
                    action: climate.set_preset_mode
                    data:
                      entity_id: climate.chauffage_maison
                      preset_mode: !lambda |-
                        if (x == 0) return "away";
                        if (x == 1) return "comfort";
                        if (x == 2) return "home";
                        return "none";

      # Page METEO
      - id: page_meteo
        bg_color: COLOR_CSS_SKYBLUE
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: METEO
        widgets:
          # TITRE METEO DU JOUR
          - label:
              align: CENTER
              y: -170
              text: "AUJOURD'HUI"
              text_font: roboto_xl
              text_color: COLOR_CSS_BLACK

          # METEO DU JOUR
          - obj:
              align: CENTER
              x: -75
              y: -80
              width: 140
              height: 140
              pad_all: 10
              bg_color: COLOR_CSS_WHITE
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(2), FR(1)]
                grid_columns: [FR(1)]
              widgets:
                - label:
                    text: "..."
                    id: widget_meteo_condition_icon_meteo_jour
                    text_font: icons_page_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    text_align: CENTER
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: STRETCH
                - label:
                    text: "Unknown"
                    id: widget_meteo_condition_name_meteo_jour
                    text_align: CENTER
                    #text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 0
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: CENTER

          - obj:
              align: CENTER
              bg_color: COLOR_CSS_WHITE
              x: 75
              y: -80
              width: 140
              height: 140
              pad_all: 10
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(1), FR(1), FR(1), FR(1)]
                grid_columns: [FR(1), FR(1)]
              widgets:
                - label:
                    text: "--.- °C"
                    text_font: meteo_actuelle_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_actuelle_meteo_jour
                    text_align: RIGHT
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_column_span: 2
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Max:"
                    text_font: meteo_min_max_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_max_meteo_jour
                    text_align: RIGHT
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Min:"
                    text_font: meteo_min_max_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    #text_color: COLOR_CSS_WHITE
                    id: widget_meteo_temp_min_meteo_jour
                    text_align: RIGHT
                    grid_cell_row_pos: 3
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH

          # TITRE METEO DU LENDEMAIN
          - label:
              align: CENTER
              y: 20
              text: "DEMAIN"
              text_font: roboto_xl
              text_color: COLOR_CSS_BLACK

          # METEO DU LENDEMAIN
          - obj:
              align: CENTER
              x: -75
              y: 110
              width: 140
              height: 140
              pad_all: 10
              bg_color: COLOR_CSS_WHITE
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(2), FR(1)]
                grid_columns: [FR(1)]
              widgets:
                - label:
                    text: "..."
                    id: widget_meteo_condition_icon_meteo_demain
                    text_font: icons_page_screen_saver
                    text_align: CENTER
                    grid_cell_row_pos: 0
                    grid_cell_column_pos: 0
                    grid_cell_x_align: CENTER
                    grid_cell_y_align: STRETCH
                - label:
                    text: "Unknown"
                    id: widget_meteo_condition_name_meteo_demain
                    text_align: CENTER
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 0
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: CENTER

          - obj:
              align: CENTER
              bg_color: COLOR_CSS_WHITE
              x: 75
              y: 110
              width: 140
              height: 140
              pad_all: 10
              layout:
                pad_column: 0
                type: GRID
                grid_rows: [FR(1), FR(1), FR(1), FR(1)]
                grid_columns: [FR(1), FR(1)]
              widgets:
                - label:
                    text: "Max:"
                    text_font: meteo_min_max_screen_saver
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    id: widget_meteo_temp_max_meteo_demain
                    text_align: RIGHT
                    grid_cell_row_pos: 1
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH

                - label:
                    text: "Min:"
                    text_font: meteo_min_max_screen_saver
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 0

                - label:
                    text: "--.- °C"
                    text_font: meteo_min_max_screen_saver
                    id: widget_meteo_temp_min_meteo_demain
                    text_align: RIGHT
                    grid_cell_row_pos: 2
                    grid_cell_column_pos: 1
                    grid_cell_x_align: STRETCH

      # Page HOME
      - id: home
        bg_color: COLOR_CSS_SKYBLUE
        on_load:
          - then:
              - lvgl.label.update:
                  id:
                    - id: page_title
                  text: HOME
        widgets:
          - obj:
              align: CENTER
              width: lv_pct(100)
              height: lv_pct(100)
              pad_all: 6
              bg_opa: TRANSP
              border_opa: TRANSP
              layout: 
                type: GRID 
                grid_columns: [FR(1), FR(1)]
                grid_rows: [FR(25), FR(25), FR(25), FR(25)]
                pad_row: 15
                pad_column: 15
              widgets:
                # BOUTON ALARME
                - button:
                    bg_color: COLOR_CSS_DARKBLUE
                    bg_grad_color: 0x03034D
                    bg_grad_dir: VER
                    id: button_nav_alarm
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 0
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    on_short_click:
                      then:
                        - if:
                            condition:
                              lambda: 'return id(alarm_state).state == "disarmed";'
                            then:
                              - lvgl.page.show: 
                                  id: page_alarme_inactive
                                  animation: MOVE_RIGHT
                                  time: ${page_anim_time}
                            else:
                              - lvgl.page.show: page_alarme_active
                    widgets:
                      - label:
                          id: button_nav_alarm_text
                          text: "ALARME"
                          align: TOP_LEFT
                      - label:
                          id: button_nav_alarm_icon
                          text: ${mdi_security}
                          text_font: icon_button_home
                          align: BOTTOM_RIGHT

                # BOUTON CHAUFFAGE
                - button:
                    bg_color: COLOR_CSS_FIREBRICK
                    bg_grad_color: 0x8F1111
                    bg_grad_dir: VER
                    id: button_nav_chauffage
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 0
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    on_short_click:
                          then:
                            lvgl.page.show: 
                              id: page_chauffage
                              animation: MOVE_RIGHT
                              time: ${page_anim_time}
                    widgets:
                      - label:
                          id: button_nav_chauffage_text
                          text: "CHAUFFAGE"
                          align: TOP_LEFT
                      - label:
                          id: button_nav_chauffage_icon
                          text: "\U000F0438"
                          text_font: icon_button_home
                          align: BOTTOM_RIGHT

                # BOUTON METEO
                - button:
                    bg_color: COLOR_CSS_GOLDENROD
                    bg_grad_color: 0x99710C
                    bg_grad_dir: VER
                    id: button_nav_meteo
                    grid_cell_column_pos: 0
                    grid_cell_row_pos: 1
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    on_short_click:
                          then:
                            lvgl.page.show: 
                              id: page_meteo
                              animation: MOVE_RIGHT
                              time: ${page_anim_time}
                    widgets:
                      - label:
                          id: button_nav_meteo_text
                          text: "METEO"
                          align: TOP_LEFT
                      - label:
                          id: button_nav_meteo_icon
                          text: "\U000F0595"
                          text_font: icon_button_home
                          align: BOTTOM_RIGHT

                # BOUTON DIVERS
                - button:
                    bg_color: COLOR_CSS_FORESTGREEN
                    bg_grad_color: 0x076607
                    bg_grad_dir: VER
                    id: button_nav_divers
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 1
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    on_short_click:
                          then:
                            lvgl.page.show: 
                              id: page_divers
                              animation: MOVE_RIGHT
                              time: ${page_anim_time}
                    widgets:
                      - label:
                          id: button_nav_divers_text
                          text: "DIVERS"
                          align: TOP_LEFT
                      - label:
                          id: button_nav_divers_icon
                          text: ${mdi_robot}
                          text_font: icon_button_home
                          align: BOTTOM_RIGHT

                # BOUTON TEMPORAIRE
                - button:
                    bg_color: COLOR_CSS_GREY
                    hidden: true
                    id: button_nav_tmp2
                    grid_cell_column_pos: 1
                    grid_cell_row_pos: 3
                    grid_cell_x_align: STRETCH
                    grid_cell_y_align: STRETCH
                    on_short_click:
                          then:
                            lvgl.page.show: 
                              id: page_tmp
                              animation: MOVE_RIGHT
                              time: ${page_anim_time}
                    widgets:
                      - label:
                          id: button_nav_tmp2_text
                          text: "TEMPO"
                          align: TOP_LEFT
                      - label:
                          id: button_nav_tmp2_icon
                          text: ${mdi_robot}
                          text_font: icon_button_home
                          align: BOTTOM_RIGHT
        pad_top: 50
        pad_bottom: 50

    color_depth: 16
    full_refresh: false
    draw_rounding: 4
    buffer_size: 30%
    log_level: WARN
    byte_order: big_endian
    page_wrap: true
    resume_on_input: true




# -------------------------------------------------------------------
# GESTION MOT DE PASSE ALARME
# -------------------------------------------------------------------
key_collector:
  - source_id: lvgl_keypad
    min_length: 6
    max_length: 6
    end_keys: "#"
    end_key_required: true
    back_keys: "*"
    allowed_keys: "0123456789*#"
    timeout: 15s
    on_progress:
      - if:
          condition:
            lambda: return (0 != x.compare(std::string{""}));
          then:
            - lvgl.label.update:
                id: lvgl_label
                text: !lambda 'return x.c_str();'
          else:
            - lvgl.label.update:
                id: lvgl_label
                text: "code"
    on_result:
      - if:
          condition:
            lambda: |-
              return x == "${code}";
            #return x == std::string("${code}");
            #lambda: return (0 == x.compare(std::string{"068280"}));
          then:
            - homeassistant.action:
                action: script.turn_on
                data:
                  entity_id: script.alarmo_off_script
            - lvgl.page.show: page_alarme_inactive
